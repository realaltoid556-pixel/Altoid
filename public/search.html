<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Starry Proxy | Viewer</title>
    <link rel="stylesheet" href="index.css" />
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #111; }
        #sj-frame { width: 100%; height: 100%; border: none; }
    </style>
    
    <script src="/scram/scramjet.all.js"></script>
    <script src="/baremux/index.js"></script>
    <script src="search.js"></script>
</head>
<body>
    <script>
        const { ScramjetController } = $scramjetLoadController();
        const scramjet = new ScramjetController({
            files: {
                wasm: "/scram/scramjet.wasm.wasm",
                all: "/scram/scramjet.all.js",
                sync: "/scram/scramjet.sync.js",
            },
        });
        scramjet.init();

        const connection = new BareMux.BareMuxConnection("/baremux/worker.js");

        async function loadProxy() {
            const params = new URLSearchParams(window.location.search);
            const url = params.get('url');

            if (!url) {
                window.location.href = "index.html";
                return;
            }

            let wispUrl = (location.protocol === "https:" ? "wss" : "ws") + "://" + location.host + "/wisp/";
            
            if ((await connection.getTransport()) !== "/libcurl/index.mjs") {
                await connection.setTransport("/libcurl/index.mjs", [{ websocket: wispUrl }]);
            }

            const frame = scramjet.createFrame();
            frame.frame.id = "sj-frame";
            document.body.appendChild(frame.frame);
            frame.go(url);
        }

        loadProxy();
    </script>
</body>
</html>